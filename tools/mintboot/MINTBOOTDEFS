TEST_COBJS = \
	tests/fs_fat/mb_fat_tests.c \
	tests/fs_fat/mb_fat_test_support.c \
	tests/fs_fat/mb_fat_test_lookup.c \
	tests/fs_fat/mb_fat_test_rename.c \
	tests/fs_fat/mb_fat_test_dir.c \
	tests/fs_fat/mb_fat_test_core.c \
	tests/mb_test_helpers.c \
	tests/mb_test_setexc.c \
	tests/mb_test_super.c \
	tests/mb_test_gettime.c \
	tests/mb_test_drive_range.c \
	tests/mb_test_drive_path.c \
	tests/mb_test_bconmap.c \
	tests/mb_test_bios_bdos.c \
	tests/mb_test_vbclock.c \
	tests/mb_test_kernel_loader.c \
	tests/mb_tests_main.c

ifeq ($(mintboot),generic)
TARGET = ../libmintboot-generic.a
CPU = 000
COBJS = \
	common/mb_common.c \
	common/mb_cookie.c \
	common/mb_traps.c \
	common/mb_log.c \
	common/mb_debug.c \
	common/mb_coverage.c \
	common/fs_fat/mb_fat_core.c \
	common/fs_fat/mb_fat_dir.c \
	common/fs_fat/mb_fat_file.c \
	common/fs_fat/mb_fat_check.c \
	common/mb_kernel.c \
	common/mb_lib.c \
	common/mb_util.c \
	common/linea/mb_linea.c \
	common/bios/dispatch.c \
	common/bios/bconstat.c \
	common/bios/bconin.c \
	common/bios/bconout.c \
	common/bios/rwabs.c \
	common/bios/setexc.c \
	common/bios/getbpb.c \
	common/bios/bcostat.c \
	common/bios/drvmap.c \
	common/bios/kbshift.c \
	common/bios/lowmem.c \
	common/vdi/dispatch.c \
	common/xbios/dispatch.c \
	common/xbios/initmous.c \
	common/xbios/physbase.c \
	common/xbios/logbase.c \
	common/xbios/getrez.c \
	common/xbios/iorec.c \
	common/xbios/rsconf.c \
	common/xbios/keytbl.c \
	common/xbios/cursconf.c \
	common/xbios/settime.c \
	common/xbios/gettime.c \
	common/xbios/bioskeys.c \
	common/xbios/offgibit.c \
	common/xbios/ongibit.c \
	common/xbios/dosound.c \
	common/xbios/kbdvbase.c \
	common/xbios/vsync.c \
	common/xbios/supexec.c \
	common/xbios/bconmap.c \
	common/xbios/vsetscreen.c \
	common/xbios/kbrate.c \
	common/xbios/lowmem.c \
	common/bdos/state.c \
	common/bdos/dispatch.c \
	common/bdos/fsetdta.c \
	common/bdos/fgetdta.c \
	common/bdos/dfree.c \
	common/bdos/dsetpath.c \
	common/bdos/dsetdrv.c \
	common/bdos/dgetdrv.c \
	common/bdos/dgetpath.c \
	common/bdos/pterm0.c \
	common/bdos/cconin.c \
	common/bdos/cconws.c \
	common/bdos/fcreate.c \
	common/bdos/fopen.c \
	common/bdos/fclose.c \
	common/bdos/fread.c \
	common/bdos/fwrite.c \
	common/bdos/fdelete.c \
	common/bdos/fseek.c \
	common/bdos/flock.c \
	common/bdos/fcntl.c \
	common/bdos/memory.c \
	board/mb_board.c
ifeq ($(MINTBOOT_TESTS),yes)
COBJS += $(TEST_COBJS)
endif
SOBJS = common/mb_vectors.S
endif

MINTBOOT_CROSSPREFIX ?= m68k-atari-mintelf-

ifeq ($(mintboot),virt)
TARGET = mintboot-virt.elf
CPU = 040
BUILD_ELF = yes
COBJS = \
	common/mb_common.c \
	common/mb_cookie.c \
	common/mb_traps.c \
	common/mb_log.c \
	common/mb_debug.c \
	common/mb_coverage.c \
	common/fs_fat/mb_fat_core.c \
	common/fs_fat/mb_fat_dir.c \
	common/fs_fat/mb_fat_file.c \
	common/fs_fat/mb_fat_check.c \
	common/mb_kernel.c \
	common/mb_lib.c \
	common/mb_util.c \
	common/linea/mb_linea.c \
	common/bios/dispatch.c \
	common/bios/bconstat.c \
	common/bios/bconin.c \
	common/bios/bconout.c \
	common/bios/rwabs.c \
	common/bios/setexc.c \
	common/bios/getbpb.c \
	common/bios/bcostat.c \
	common/bios/drvmap.c \
	common/bios/kbshift.c \
	common/bios/lowmem.c \
	common/vdi/dispatch.c \
	common/xbios/dispatch.c \
	common/xbios/initmous.c \
	common/xbios/physbase.c \
	common/xbios/logbase.c \
	common/xbios/getrez.c \
	common/xbios/iorec.c \
	common/xbios/rsconf.c \
	common/xbios/keytbl.c \
	common/xbios/cursconf.c \
	common/xbios/settime.c \
	common/xbios/gettime.c \
	common/xbios/bioskeys.c \
	common/xbios/offgibit.c \
	common/xbios/ongibit.c \
	common/xbios/dosound.c \
	common/xbios/kbdvbase.c \
	common/xbios/vsync.c \
	common/xbios/supexec.c \
	common/xbios/bconmap.c \
	common/xbios/vsetscreen.c \
	common/xbios/kbrate.c \
	common/xbios/lowmem.c \
	common/bdos/state.c \
	common/bdos/dispatch.c \
	common/bdos/fsetdta.c \
	common/bdos/fgetdta.c \
	common/bdos/dfree.c \
	common/bdos/dsetpath.c \
	common/bdos/dsetdrv.c \
	common/bdos/dgetdrv.c \
	common/bdos/dgetpath.c \
	common/bdos/pterm0.c \
	common/bdos/cconin.c \
	common/bdos/cconws.c \
	common/bdos/fcreate.c \
	common/bdos/fopen.c \
	common/bdos/fclose.c \
	common/bdos/fread.c \
	common/bdos/fwrite.c \
	common/bdos/fdelete.c \
	common/bdos/fseek.c \
	common/bdos/flock.c \
	common/bdos/fcntl.c \
	common/bdos/memory.c \
	board/virt/mb_board_virt.c \
	board/virt/mb_rom_virt.c
ifeq ($(MINTBOOT_TESTS),yes)
COBJS += $(TEST_COBJS)
endif
SOBJS = common/mb_vectors.S board/virt/mb_virt_entry.S
LDSCRIPT = $(srcdir)/board/virt/mb_virt.ld
endif

mintboottargets = generic virt

cflags += -msoft-float

MINTBOOT_TESTS ?= no
MINTBOOT_TESTS_EXIT ?= no
ifeq ($(MINTBOOT_TESTS_EXIT),yes)
cflags += -DMB_EXIT_AFTER_TESTS=1
endif

MINTBOOT_COVERAGE ?= no
ifeq ($(MINTBOOT_COVERAGE),yes)
cflags += -fprofile-arcs -ftest-coverage -fprofile-info-section
cflags += -DMB_ENABLE_COVERAGE=1
MINTBOOT_EXTRA_LIBS += -lgcov
endif
